{% extends "base.html" %}

{% block title %}My Profile - Clinic Management{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- Profile Sidebar -->
        <div class="col-md-4 mb-4">
            <div class="card shadow border-0">
                <div class="card-body text-center">
                    <!-- Profile Picture -->
                    <div class="profile-picture mb-3">
                        <i class="bi bi-person-circle text-primary" style="font-size: 6rem;"></i>
                    </div>
                    <h4>{{ session.get('name', 'User') }}</h4>
                    <p class="text-muted">
                        <span class="badge bg-{{ 
                            'success' if session.get('role') == 'doctor' 
                            else 'primary' if session.get('role') == 'patient' 
                            else 'warning' if session.get('role') == 'assistant'
                            else 'danger'
                        }}">
                            {{ session.get('role', 'User')|title }}
                        </span>
                    </p>
                    <p class="small text-muted">{{ session.get('username') }}</p>
                </div>
            </div>

            <!-- Navigation -->
            <div class="card shadow border-0 mt-3">
                <div class="list-group list-group-flush">
                    <a href="{{ url_for('auth.dashboard') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    {% if session.get('role') == 'patient' %}
                    <a href="{{ url_for('patient.appointments') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-calendar-check"></i> My Appointments
                    </a>
                    <a href="{{ url_for('patient.diagnosis') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-file-medical"></i> Medical History
                    </a>
                    {% elif session.get('role') == 'doctor' %}
                    <a href="{{ url_for('doctor.doctor_home') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-calendar-day"></i> Today's Patients
                    </a>
                    <a href="{{ url_for('doctor.schedule') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-clock"></i> My Schedule
                    </a>
                    {% elif session.get('role') == 'assistant' %}
                    <a href="{{ url_for('assistant.assistant_home') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-calendar-week"></i> All Appointments
                    </a>
                    {% elif session.get('role') == 'admin' %}
                    <a href="{{ url_for('admin.admin_home') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-user-shield"></i> Admin Panel
                    </a>
                    {% endif %}
                    <a href="{{ url_for('auth.logout') }}" class="list-group-item list-group-item-action text-danger">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Profile Content -->
        <div class="col-md-8 mb-4">
            <!-- Personal Information -->
            <div class="card shadow border-0 mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-user-edit"></i> Personal Information
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('auth.profile') }}">
                        <input type="hidden" name="update_profile" value="1">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" name="name" 
                                       value="{{ session.get('name', '') }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone Number *</label>
                                <input type="text" class="form-control" name="phone" 
                                       value="{{ session.get('phone', '') }}" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" 
                                   value="{{ session.get('username', '') }}">
                            <small class="text-muted">This will be your new login email</small>
                        </div>
                        
                        {% if session.get('role') == 'patient' %}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date of Birth</label>
                                <input type="date" class="form-control" name="birth_date" 
                                       value="{{ session.get('birth_date', '') }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Gender</label>
                                <select class="form-select" name="gender">
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other" selected>Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" name="address" rows="2">{{ session.get('address', '') }}</textarea>
                        </div>
                        {% elif session.get('role') == 'doctor' %}
                        <div class="mb-3">
                            <label class="form-label">Specialization</label>
                            <input type="text" class="form-control" name="specialization" 
                                   value="{{ session.get('specialization', '') }}">
                        </div>
                        {% endif %}
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Profile
                        </button>
                    </form>
                </div>
            </div>

            <!-- Change Password -->
            <div class="card shadow border-0 mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-lock"></i> Change Password
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('auth.change_password') }}">
                        <div class="mb-3">
                            <label class="form-label">Current Password *</label>
                            <input type="password" class="form-control" name="current_password" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">New Password *</label>
                                <input type="password" class="form-control" name="new_password" required>
                                <small class="text-muted">Minimum 6 characters</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Confirm New Password *</label>
                                <input type="password" class="form-control" name="confirm_password" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-key"></i> Change Password
                        </button>
                    </form>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="card shadow border-0">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle"></i> Danger Zone
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Once you delete your account, there is no going back. Please be certain.</p>
                    <form method="POST" action="{{ url_for('auth.delete_account') }}" 
                          onsubmit="return confirm('Are you absolutely sure you want to delete your account? This action cannot be undone!');">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Delete My Account
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}